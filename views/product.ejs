<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#000">
  <title><%= product.name %> - –§–æ—Ä–º–∞3D</title>
  <link rel="icon" href="/image/logo.webp" type="image/png">
  <link rel="stylesheet" href="/stylesproduct.css" />
  <style>
    /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è */
    .order-actions .buy-button {
      border-radius: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 50px;
      text-decoration: none;
      color: white;
      cursor: pointer;
    }

    /* –ï—Ñ–µ–∫—Ç "–∞–∫—Ç–∏–≤–Ω–æ—ó" –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ */
    .order-actions .buy-button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      filter: brightness(1.2);
    }

    .order-actions .buy-button:active {
      transform: translateY(0);
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –ø—ñ–¥–∫–∞–∑–∫–∏ */
    #selectColorPrompt {
      background: #555;
      border: 1px dashed rgba(255, 255, 255, 0.3);
      color: #ccc;
      text-align: center;
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      cursor: pointer;
      font-weight: bold;
      text-transform: uppercase;
    }
  </style>
</head>
<body>

  <div class="contact-overlay" id="contactOverlay" onclick="closeContact()"></div>
  <div class="horizontal-contact" id="horizontalContact" onclick="openContact()">–ó–≤'—è–∑–æ–∫</div>
  <div class="contact-bar" id="contactBar">
    <div class="contact-content">
      <div class="contact-header"><span>–ó–≤'—è–∑–æ–∫</span><span class="close-btn" onclick="closeContact()">‚úñ</span></div>
      <label>Email:</label><input type="email" id="email" value="zippoziga32@gmail.com" readonly />
      <label>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</label><textarea id="message" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."></textarea>
      <button onclick="sendContactEmail()">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>      
    </div>
  </div>

  <header>
    <div class="logo">–§–æ—Ä–º–∞3D</div>
    <a href="/catalog" class="back-link">‚Üê –î–æ –∫–∞—Ç–∞–ª–æ–≥—É</a>
  </header>
  
  <main>
    <section class="section">
      <div class="content-wrapper">
        <div class="product-info">
          
          <div class="product-image">
             <div class="carousel" id="productCarousel">
                <button class="arrow left" id="prevBtn">&#10094;</button>

                <% 
                   let images = [];
                   if (product.images) {
                       try {
                           images = JSON.parse(product.images);
                       } catch(e) { images = [product.img]; }
                   } else {
                       images = [product.img];
                   }
                %>

                <% images.forEach((imgSrc, index) => { %>
                    <img 
                        src="/<%= imgSrc %>" 
                        class="<%= index === 0 ? 'active' : '' %>" 
                        alt="<%= product.name %>"
                        onerror="this.src='/image/logo.webp'"
                    >
                <% }); %>
                
                <button class="arrow right" id="nextBtn">&#10095;</button>
             </div>
          </div>

          <div class="product-details">
            <h1><%= product.name %></h1>
            
            <p>‚Ä¢ –û–ø–∏—Å: <%= product.description || '–û–ø–∏—Å —Å–∫–æ—Ä–æ –∑\'—è–≤–∏—Ç—å—Å—è...' %></p>
            <p>‚Ä¢ –ö–æ–º—É –ø—ñ–¥—Ö–æ–¥–∏—Ç—å: <%= product.info || '–î–ª—è –≤—Å—ñ—Ö!' %></p>
            
            <p class="price-tag">–¶—ñ–Ω–∞: <%= product.price %> –ì–†–ù</p>

            <p style="margin-bottom: 5px; margin-top: 20px;">–û–±–µ—Ä—ñ—Ç—å –∫–æ–ª—ñ—Ä:</p>
            
            <div class="color-options">
              <% 
                 let productColors = [];
                 if (product && product.colors) {
                     try {
                         productColors = JSON.parse(product.colors);
                     } catch(e) { productColors = []; }
                 }
              %>

              <% if (productColors.length > 0) { %>
                  <% productColors.forEach(color => { %>
                      <% let borderClass = (color.name === '–±—ñ–ª–∏–π') ? 'with-border' : ''; %>
                      <div class="color-circle <%= borderClass %>" 
                           style="background-color: <%= color.hex %>;" 
                           data-color="<%= color.name %>" 
                           data-image="<%= color.img %>">
                      </div>
                  <% }); %>
              <% } else { %>
                  <p style="color: #777; font-size: 14px;">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –∫–æ–ª—ñ—Ä</p>
              <% } %>
            </div>

            <div id="orderActions" style="display: none; flex-direction: row; gap: 10px; margin-top: 20px;">
                <a id="buyGmail" class="buy-button" href="javascript:void(0)" target="_blank" style="background: #d44638; flex: 1;">
                    Gmail
                </a>
                <a id="buyTelegram" class="buy-button" href="javascript:void(0)" target="_blank" style="background: #0088cc; flex: 1;">
                    Telegram
                </a>
            </div>

            <div id="selectColorPrompt" onclick="alert('–ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å –∫–æ–ª—ñ—Ä!')">
                –û–±–µ—Ä—ñ—Ç—å –∫–æ–ª—ñ—Ä –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
            </div>

          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div id="footer" class="footer-content">
      <p>@ –ü–æ—à—Ç–∞: <a href="mailto:zippoziga32@gmail.com">zippoziga32@gmail.com</a></p>
      <p>‚úÜ –¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:0677772819">0677772819</a></p>
      <p>‚úà Telegram: <a href="https://t.me/zippoziga">@zippoziga</a></p>
      <p>‚úì –£–º–æ–≤–∏ <a href="/privacy">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</a></p>
    </div>
  </footer>

  <script>
    // === 1. –õ–û–ì–Ü–ö–ê –°–õ–ê–ô–î–ï–†–ê ===
    const carousel = document.getElementById('productCarousel');
    const images = carousel.querySelectorAll('img');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    let currentIndex = 0;

    function updateCarousel() {
      images.forEach((img, i) => img.classList.toggle('active', i === currentIndex));
      if (images.length > 1) {
          prevBtn.disabled = currentIndex === 0;
          nextBtn.disabled = currentIndex === images.length - 1;
      } else {
          prevBtn.disabled = nextBtn.disabled = true;
      }
    }

    prevBtn.addEventListener('click', () => { if (currentIndex > 0) currentIndex--; updateCarousel(); });
    nextBtn.addEventListener('click', () => { if (currentIndex < images.length - 1) currentIndex++; updateCarousel(); });
    updateCarousel();

    // === 2. –õ–û–ì–Ü–ö–ê GMAIL –î–õ–Ø –ó–í'–Ø–ó–ö–£ ===
    function sendContactEmail() {
        const messageInput = document.getElementById('message');
        const messageText = messageInput.value.trim();

        if (!messageText) {
            alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è!");
            return;
        }

        const recipient = "zippoziga32@gmail.com";
        const subject = encodeURIComponent("–ó–∞–ø–∏—Ç–∞–Ω–Ω—è –≤—ñ–¥ –∫–ª—ñ—î–Ω—Ç–∞ ‚Äî –§–æ—Ä–º–∞3D");
        const bodyText = encodeURIComponent(
            `–î–æ–±—Ä–æ–≥–æ –¥–Ω—è! –ú–µ–Ω–µ —Ü—ñ–∫–∞–≤–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —â–æ–¥–æ –ø–æ—Å–ª—É–≥ –§–æ—Ä–º–∞3D.\n` +
            `---------------------------\n` +
            `üí¨ –ü–∏—Ç–∞–Ω–Ω—è:\n${messageText}\n` +
            `---------------------------\n` +
            `‚ö†Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏" —É –≤—ñ–∫–Ω—ñ –ø–æ—à—Ç–∏.`
        );

        const gmailUrl = `https://mail.google.com/mail/u/0/?fs=1&to=${recipient}&su=${subject}&body=${bodyText}&tf=cm`;
        window.open(gmailUrl, '_blank');
        
        messageInput.value = ""; 
        closeContact(); 
    }

    // === 3. –í–ò–ë–Ü–† –ö–û–õ–¨–û–†–£ –¢–ê –ì–ï–ù–ï–†–ê–¶–Ü–Ø –ü–û–°–ò–õ–ê–ù–¨ ===
    const circles = document.querySelectorAll('.color-circle');
    const orderActions = document.getElementById('orderActions');
    const selectColorPrompt = document.getElementById('selectColorPrompt');
    const buyGmail = document.getElementById('buyGmail');
    const buyTelegram = document.getElementById('buyTelegram');

    circles.forEach(circle => {
      circle.addEventListener('click', function() {
        circles.forEach(c => c.classList.remove('selected'));
        this.classList.add('selected');
        
        const selectedColor = this.getAttribute('data-color');
        const newImageSrc = this.getAttribute('data-image');
        const productName = "<%= product.name %>";
        const productPrice = "<%= product.price %>";

        if (newImageSrc && newImageSrc !== 'undefined') {
            const activeImg = carousel.querySelector('img.active');
            if (activeImg) activeImg.src = newImageSrc.startsWith('/') ? newImageSrc : '/' + newImageSrc;
        }
        
        // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –∫–Ω–æ–ø–∫–∏
        selectColorPrompt.style.display = 'none';
        orderActions.style.display = 'flex';

        // –î—ñ–ª–æ–≤–∏–π —Ç–µ–∫—Å—Ç –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–û–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ "—Ç–æ–≤–∞—Ä")
        const businessRequest = `–î–æ–±—Ä–æ–≥–æ –¥–Ω—è! –ú–µ–Ω–µ –∑–∞—Ü—ñ–∫–∞–≤–∏–≤ –≤–∞—à —Ç–æ–≤–∞—Ä: "${productName}".\n` +
                                `–ë–∞–∂–∞—é –æ—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ –¥–∞–Ω—É –º–æ–¥–µ–ª—å —É –∫–æ–ª—å–æ—Ä—ñ: ${selectedColor}.\n` +
                                `–¶—ñ–Ω–∞, –≤–∫–∞–∑–∞–Ω–∞ –Ω–∞ —Å–∞–π—Ç—ñ: ${productPrice} –ì–†–ù.\n` +
                                `–ë—É–¥—É –≤–¥—è—á–Ω–∏–π –∑–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —â–æ–¥–æ —Ç–µ—Ä–º—ñ–Ω—ñ–≤ –≤–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏.`;

        // Gmail
        buyGmail.href = `https://mail.google.com/mail/u/0/?fs=1&to=zippoziga32@gmail.com&su=${encodeURIComponent('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: ' + productName)}&body=${encodeURIComponent(businessRequest)}&tf=cm`;

        // Telegram
        buyTelegram.href = `https://t.me/zippoziga?text=${encodeURIComponent(businessRequest)}`;
      });
    });
  </script>
  <script src="/script.js"></script>
</body>
</html>